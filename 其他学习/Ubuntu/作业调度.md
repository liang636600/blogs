# 1 定时运行后台作业

| 命令与守护进程 | 调度功能                         | crontab文件                                                  | 调度的脚本文件                                               | 控制文件                            |
| -------------- | -------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ----------------------------------- |
| crontab/cron   | 按照指定的时间重复执行指定的任务 | /etc/crontab<br />/etc/cron.d/*<br />/var/spool/cron/crontabs/ * | /var/cron.hourly/*<br />/etc/cron.daily/ *<br />/etc/cron.weekly/ *<br />/etc/cron.monthly/ * | /etc/cron.deny<br />/etc/cron.allow |
| at/batch/atd   | 定时执行单个任务                 |                                                              | /var/spool/cron/atjobs/*                                     | /etc/cron.deny<br />/etc/cron.allow |
| anacron        | 调度错失执行时间的作业           | /etc/anacrontab                                              | /etc/cron.daily/ *<br />/etc/cron.weekly/ *<br />/etc/cron.monthly/ * |                                     |

## cron守护进程的调度过程

cron守护进程的主要功能是管理和调度以crontab文件形式提交的后台作业，按照指定的日期和时间自动执行的命令。一经启动，cron守护进程将首先检测/var/spool/cron/crontabs目录中是否存在用户定义的，并以用户名命名的crontab文件，然后检测/etc/crontab文件，最后检测/etc/cron.d目录中是否存在系统crontab文件。如果存在，cron守护进程将会执行下列任务：

* 读取并加载crontab文件中定义的任务，其中包括执行时间和相应的命令（或shell脚本）
* 每分钟运行一次，检查已加载到内存中的每一项任务。如果某一任务的指定时间与当前系统时间匹配，则调度执行相应的命令或脚本
* 在执行执行的命令或脚本时，其中的任何输出信息将会通过电子邮件的形式发送给crontab文件的属主，或由crontab文件中MAILTO环境变量指定的用户
* 检查/var/spool/cron/crontabs和/etc/cron.d目录，以及/etc/crontab文件自加载后其修改时间是否发生变化。如有变化，cron将重新考察上述两个目录中所有crontab文件，重新加载已经编辑或修改过的crontab文件

为了利用cron守护进程，提交定时重复执行的定时任务（命令或脚本），可以选用/etc/crontab或/etc/cron.d目录中的一个crontab文件，手动编辑选定的文件，增加自己的定时执行任务。也可以使用crontab命令，在/var/spool/cron/crontabs目录中创建、编辑或删除自己的crontab文件（对于只需执行一次的命令或shell脚本，可以使用at命令，提交atd守护进程，使之按照指定的时间调度运行）

## at作业和atd守护进程

利用at命令，用户能够提交在指定的时间开始执行的作业。at命令提交的任务仅在指定的时间执行一次。执行之后，定期从其作业目录中删除相应的文件。在利用at命令提交作业时，应把命令或shell脚本的输出信息重定向并存储到一个文件中。

## 调度错过执行时间的任务

anacron能够以指定的天数作为时间间隔，周期地执行命令。与cron不同，anacron假定计算机系统并非不间断地运行。当随着系统的启动开始运行时，anacron将会从默认的配置文件/etc/anacrontab（除非另行指定）中读取须由anacron调度执行的一系列作业定义。每个作业定义包含以天数为单位的时间周期，以分钟为单位的时间延迟、作业标识符，以及指定的命令或shell脚本。

anacron的配置文件/etc/anacrontab描述了anacron调度执行的作业。这个配置文件由两种文本行组成：作业描述行与环境变量赋值行。作业描述行的语法格式如下：

`period delay job-identifier command`

其中，period是以天数为单位的时间间隔，delay是以分钟为单位的延迟时间。job-identifier可以包含任何非空格字符及斜杠字符"/",用于标识anacron作业，同时用作作业时戳文件的名字。command可以是任何命令或shell脚本。

# 2 调度重复执行的任务

