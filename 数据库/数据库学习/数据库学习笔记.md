# 数据库物理结构设计

![image-20220828111626451](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828111626451.png)

![image-20220828112059995](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828112059995.png)

![image-20220828112413298](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828112413298.png)

![image-20220828152131039](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828152131039.png)

![image-20220828152412342](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828152412342.png)

![image-20220828153053640](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828153053640.png)

![image-20220828153510230](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828153510230.png)

![image-20220828153613091](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828153613091.png)

![image-20220828153838493](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828153838493.png)

![image-20220828154056172](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828154056172.png)

# 关系查询处理

![image-20220828161351864](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828161351864.png)

![image-20220828161422513](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828161422513.png)

![image-20220828162503763](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828162503763.png)

![image-20220828163132891](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828163132891.png)

![image-20220828163237738](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828163237738.png)

![image-20220828163406430](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828163406430.png)

![image-20220828163545167](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828163545167.png)

![image-20220828163715899](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828163715899.png)

![image-20220828163934238](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828163934238.png)

![image-20220828164354233](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828164354233.png)

# 关系查询优化

![image-20220828165419530](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828165419530.png)

![image-20220828171722796](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828171722796.png)

![image-20220828171741304](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828171741304.png)

## 代数优化

![image-20220828184943151](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828184943151.png)

![image-20220828185339840](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828185339840.png)

![image-20220828185402648](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828185402648.png)

![image-20220828185447411](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828185447411.png)

![image-20220828185532634](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828185532634.png)

![image-20220828185633165](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828185633165.png)

![image-20220828185757744](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828185757744.png)

![image-20220828185833495](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828185833495.png)

![image-20220828185847198](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828185847198.png)

![image-20220828185900303](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828185900303.png)

![image-20220828185915623](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828185915623.png)

![image-20220828185934963](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828185934963.png)

![image-20220828191829158](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828191829158.png)

![image-20220828192059204](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828192059204.png)

![image-20220828192141618](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828192141618.png)

![image-20220828192229019](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828192229019.png)

![image-20220828192310033](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828192310033.png)

![image-20220828192325426](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828192325426.png)

![image-20220828193059290](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828193059290.png)

![image-20220828193024710](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828193024710.png)

## 物理优化

![image-20220828194551147](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828194551147.png)

![image-20220828194640641](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828194640641.png)

![image-20220828194755768](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828194755768.png)

![image-20220828194808787](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828194808787.png)

![image-20220828194844053](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828194844053.png)

![image-20220828194856762](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828194856762.png)

![image-20220828195018210](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828195018210.png)

![image-20220828194932870](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828194932870.png)

![image-20220828201128742](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828201128742.png)

![image-20220828201153563](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828201153563.png)

![image-20220828201325118](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828201325118.png)

![image-20220828201409643](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828201409643.png)

![image-20220828201454576](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828201454576.png)

![image-20220828201514971](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828201514971.png)

![image-20220828201548871](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828201548871.png)

![image-20220828201609135](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828201609135.png)

![image-20220828201635648](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828201635648.png)

![image-20220828201736300](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220828201736300.png)

# 数据库恢复技术

![image-20220907190435670](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907190435670.png)

![image-20220907190706807](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907190706807.png)

![image-20220907190858141](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907190858141.png)

![image-20220907191632474](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907191632474.png)

![image-20220907192009322](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907192009322.png)

![image-20220907192131772](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907192131772.png)

![image-20220907192358930](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907192358930.png)

![image-20220907192548074](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907192548074.png)

![image-20220907192649302](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907192649302.png)

系统故障的恢复：1.撤销所有未完成的事务  2.重做所有已提交的事务

![image-20220907192919465](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907192919465.png)

![image-20220907193155569](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907193155569.png)

![image-20220907194558483](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907194558483.png)

![image-20220907194817777](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907194817777.png)

![image-20220907195025497](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907195025497.png)

![image-20220907195235160](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907195235160.png)

![image-20220907195525373](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907195525373.png)

![image-20220907195626613](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907195626613.png)

![image-20220907200213283](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907200213283.png)

![image-20220907200313021](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907200313021.png)

![image-20220907200538581](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907200538581.png)

![image-20220907200616396](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907200616396.png)

![image-20220907200743350](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907200743350.png)

![image-20220907201133923](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907201133923.png)

![image-20220907201217095](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907201217095.png)

![image-20220907201435918](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907201435918.png)

![image-20220907201908174](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907201908174.png)

![image-20220907202102046](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907202102046.png)

![image-20220907202154705](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907202154705.png)

![image-20220907203256294](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907203256294.png)

![image-20220907203503935](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907203503935.png)

![image-20220907203734626](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907203734626.png)

![image-20220907203951587](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907203951587.png)

![image-20220907204133356](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907204133356.png)

![image-20220907204351665](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907204351665.png)

![image-20220907204723623](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907204723623.png)

![image-20220907204954440](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907204954440.png)

![image-20220907205036150](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907205036150.png)

对于系统故障恢复的改进（checkpoint）

![image-20220907210555992](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907210555992.png)

![image-20220907211003014](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907211003014.png)

![image-20220907211135268](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907211135268.png)

![image-20220907211351966](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907211351966.png)

![image-20220907211859013](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907211859013.png)

![image-20220907212305949](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907212305949.png)

![image-20220907212341520](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907212341520.png)

![image-20220907213611757](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907213611757.png)

![image-20220907212617030](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907212617030.png)

解决介质故障的改进 数据库镜像

![image-20220907213807889](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907213807889.png)

![image-20220907213918961](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907213918961.png)

![image-20220907214035116](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907214035116.png)

![image-20220907214154167](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907214154167.png)

![image-20220907214236426](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220907214236426.png)

# 并发控制

![image-20220912151848220](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912151848220.png)

![image-20220912152006301](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912152006301.png)

![image-20220912152539738](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912152539738.png)

![image-20220912152700342](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912152700342.png)

![image-20220912152844184](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912152844184.png)

![image-20220912153212072](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912153212072.png)

![image-20220912153430491](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912153430491.png)

基本封锁类型：排他锁（exclusive locks，简记为X锁）和共享锁（share locks，简记为S锁）

![image-20220912154501687](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912154501687.png)

![image-20220912154536567](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912154536567.png)

![image-20220912155101990](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912155101990.png)

![image-20220912155355939](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912155355939.png)

![image-20220912155806373](C:%5CUsers%5C38403%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20220912155806373.png)

![image-20220912160130774](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912160130774.png)

![image-20220912160329373](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912160329373.png)

![image-20220912160607927](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912160607927.png)

|              |                                                    |
| ------------ | -------------------------------------------------- |
| 一级封锁协议 | 写长锁，解决丢失修改                               |
| 二级封锁协议 | 写长锁，读短锁，解决丢失修改和读脏数据             |
| 三级封锁协议 | 写长锁，读长锁，解决丢失修改和读脏数据和不可重复读 |

![image-20220912164326817](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912164326817.png)

![image-20220912164515025](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912164515025.png)

冲突可串行化-->可串行化调度 

可串行化调度 -- \ --> 冲突可串行化

数据库普遍采用两段锁协议的方法实现并发调度的可串行性，从而保证调度的正确性

![image-20220912165623020](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912165623020.png)

![image-20220912165752107](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912165752107.png)

![image-20220912170223261](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912170223261.png)

遵循两段锁协议-->可串行化

![image-20220912171453374](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912171453374.png)

![image-20220912171802205](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912171802205.png)

意向锁：在引入了加锁粒度的情况下，提高对某个数据对象加锁时系统的检查效率

表示子孙节点的加锁情况

![image-20220912172130309](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912172130309.png)

![image-20220912172238043](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912172238043.png)

![image-20220912172352102](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912172352102.png)

![image-20220912172422184](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912172422184.png)

![image-20220912172526726](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912172526726.png)

![image-20220912172616791](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912172616791.png)

![image-20220912173514399](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912173514399.png)

![image-20220912173733141](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912173733141.png)

![image-20220912174025607](https://raw.githubusercontent.com/liang636600/cloudImg/master/images/image-20220912174025607.png)

